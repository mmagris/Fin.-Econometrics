n = 20
r = rnorm(n,0,1)
r

### ACF MANUAL 
i=5
rt0 = r[(i+1):n]
rt1 = r[1:(n-i)]

cbind(rt0,rt1)

m = mean(r)

val = sum((rt0-m)*(rt1-m))/sum((r-mean(r))^2)

acf(r)[i]

qnorm(0.975,0,1)/sqrt(n) #Threshold

### ACF TEST

abs(val)
qnorm(0.975,0,1)/sqrt(n)

(1-pnorm(abs(val),0,1/sqrt(n)))*2



## BOX-PIERCE TEST

la = 5
Box.test(r, lag = la,type = c("Box-Pierce"))


t = sum((acf(r)$acf[2:(la+1)]^2))*n
t
1-pchisq(t,l)